/*
@license
webix UI v.3.2.2
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
webix.protoUI({name:"dayevents",defaults:{hourFormat:"%H",hourClock:12,firstHour:0,lastHour:24,timeScaleWidth:25,minEventHeight:20,timeScaleHeight:40,scroll:!0,scaleBorder:1,eventOffset:5,separateShortEvents:!0,width:"auto",date:new Date},$init:function(t){this.name="DayEvents",this.y.style.position="relative",this.x.className+=" webix_dayevents",this.data.provideApi(this,!0),this.data.attachEvent("onStoreUpdated",webix.bind(this.render,this)),this.attachEvent("onBeforeRender",function(){this.Tv(),this.type.color=this.config.color,this.type.textColor=this.config.textColor,this.Pe=this.y.firstChild,this.Uv(),window.scheduler&&scheduler.templates&&(this.type.template=scheduler.templates.day_event,this.type.templateCss=scheduler.templates.event_class)
}),window.scheduler&&(t.hourFormat=scheduler.config.scale_hour,t.timeScaleWidth=scheduler.xy.scale_width,t.minEventHeight=scheduler.xy.min_event_height,t.timeScaleHeight=2*scheduler.xy.scale_height,t.separateShortEvents=scheduler.config.separate_short_events)},Tv:function(){for(var t="<div></div>",e=this.config.firstHour;e<this.config.lastHour;e++)t+=this.hourScaleItem(e);
this.y.innerHTML=t},ad:"webix_l_id",on_click:{},hourScaleItem:function(t){var e=scheduler.config.hour_date,i=this.config.hourFormat,s=-1!=e.toLowerCase().indexOf("a"),n=-1!=e.indexOf("h")||-1!=e.indexOf("g"),a="00";n?(s&&(0===t&&(a="AM"),12==t&&(a="PM")),i=i.replace("H","h")):i=i.replace("h","G");var r=new Date;
r.setHours(t),t=webix.Date.dateToStr(i)(r);var h="",o=(this.config.timeScaleWidth,this.config.timeScaleHeight),l=Math.floor(this.config.timeScaleWidth),c=Math.floor(o/2),d=(c-this.config.scaleBorder,this.bc-this.config.scaleBorder-this.config.timeScaleWidth);return h+="<div style='width: 100%; height:"+o+"px;' class='webix_dayevents_scale_item'>",h+="<div class='webix_dayevents_scale_hour' style='width:"+l+"px; height:"+o+"px;line-height:"+o+"px;'>"+t+"</div>",h+="<div class='webix_dayevents_scale_event'  style='width:"+d+"px'>",h+="<div class='webix_dayevents_scale_top' style='height:"+c+"px;width:"+d+"px'></div>",h+="</div>",h+="</div>"
},type:{templateStart:webix.template("<div webix_l_id='#id#' class='webix_dayevents_event_item {common.templateCss()}' style='left:#$left#px;top:#$top#px;width:#$width#px;height:#$height#px;padding:{common.padding}px;overflow:hidden; {common.templateColor()} ;'>"),template:"#text#",templateEnd:webix.template("</div>"),templateCss:webix.template(""),templateColor:function(t){return window.scheduler?scheduler.templates.day_event_style(t):""
},padding:4},Uv:function(){var t,e,i,s,n,a,r,h=this.data.getRange(),o=[];for(this.Vv=Math.ceil(60*this.config.minEventHeight/(this.config.timeScaleHeight+1)),e=0;e<h.length;e++){for(t=h[e],t.$inner=!1;o.length&&this.Wv(o[o.length-1]).valueOf()<=t.start_date.valueOf();)o.splice(o.length-1,1);for(r=!1,i=0;i<o.length;i++)if(this.Wv(o[i]).valueOf()<=t.start_date.valueOf()){r=!0,t.$sorder=o[i].$sorder,o.splice(i,1),t.$inner=!0;
break}if(o.length&&(o[o.length-1].$inner=!0),!r)if(o.length)if(o.length<=o[o.length-1].$sorder){if(o[o.length-1].$sorder)for(i=0;i<o.length;i++){for(n=!1,s=0;s<o.length;s++)if(o[s].$sorder==i){n=!0;break}if(!n){t.$sorder=i;break}}else t.$sorder=0;t.$inner=!0}else{for(a=o[0].$sorder,i=1;i<o.length;i++)o[i].$sorder>a&&(a=o[i].$sorder);
t.$sorder=a+1,t.$inner=!1}else t.$sorder=0;o.push(t),o.length>(o.max_count||0)&&(o.max_count=o.length)}for(var e=0;e<h.length;e++)h[e].$count=o.max_count,this.Td(h[e])},Td:function(t){var e=this.config.date.getValue?this.config.date.getValue():this.config.date,i=webix.Date.copy(t.start_date),s=webix.Date.copy(t.end_date),n=i.getHours(),a=s.getHours();
webix.Date.datePart(i,!0).valueOf()>webix.Date.datePart(s,!0).valueOf()&&(s=i),webix.Date.datePart(i,!0).valueOf()<webix.Date.datePart(e,!0).valueOf()&&(i=webix.Date.datePart(e)),webix.Date.datePart(s,!0).valueOf()>webix.Date.datePart(e,!0).valueOf()&&(s=webix.Date.datePart(e,!0),s.setMinutes(0),s.setHours(this.config.lastHour)),(n<this.config.firstHour||a>=this.config.lastHour)&&(n<this.config.firstHour&&(i.setHours(this.config.firstHour),i.setMinutes(0)),a>=this.config.lastHour&&(s.setMinutes(0),s.setHours(this.config.lastHour)));
var r=Math.floor((this.bc-this.config.timeScaleWidth-this.config.eventOffset)/t.$count);t.$left=t.$sorder*r+this.config.timeScaleWidth+this.config.eventOffset,t.$inner||(r*=t.$count-t.$sorder),t.$width=r-this.config.eventOffset-2*this.type.padding;var h=60*i.getHours()+i.getMinutes(),o=60*s.getHours()+s.getMinutes()||60*this.config.lastHour;
t.$top=Math.round((h-60*this.config.firstHour)*(this.config.timeScaleHeight+1)/60),t.$height=Math.max(this.config.minEventHeight,(o-h)*(this.config.timeScaleHeight+1)/60-1)-2*this.type.padding},Wv:function(t){var e=t.end_date;if(this.config.separateShortEvents){var i=(t.end_date-t.start_date)/6e4;i<this.config.minEventHeight&&(e=webix.Date.add(e,this.Vv-i,"minute",!0))
}return e},$setSize:function(t,e){webix.ui.view.prototype.$setSize.call(this,t,e)&&this.render()}},webix.MouseEvents,webix.SelectionModel,webix.Scrollable,webix.RenderStack,webix.DataLoader,webix.ui.view,webix.EventSystem,webix.Settings),window.scheduler||(window.scheduler={config:{},templates:{},xy:{},locale:{}}),scheduler.locale||(scheduler.locale={}),scheduler.locale.labels={week_tab:"Week",day_tab:"Day",month_tab:"Month",icon_today:"Today",icon_save:"Save",icon_done:"Done",icon_delete:"Delete event",icon_cancel:"Cancel",icon_edit:"Edit",icon_back:"Back",icon_close:"Close form",icon_yes:"Yes",icon_no:"No",confirm_closing:"Your changes will be lost, are your sure ?",confirm_deleting:"The event will be deleted permanently, are you sure?",label_event:"Event",label_start:"Start",label_end:"End",label_details:"Notes",label_from:"from",label_to:"to",label_allday:"All day",label_time:"Time",label_no_events:"No Events"},scheduler.config={init_date:new Date,form_date:"%d-%m-%Y %H:%i",form_all_day:"%d-%m-%Y",parse_date:"%Y-%m-%d %H:%i",week_date:"%D, %d %M",dyn_load_date:"%Y-%m-%d",item_date:"%d.%m.%Y",all_day_date:"%l, %d %F %Y",day_header_date:"%d.%m.%Y",week_header_date:"%d.%m.%Y",hour_date:"%H:%i",scale_hour:"%H",calendar_date:"%F %Y",calendar_hour:"%H:%i",form_rules:{end_date:function(t,e){return e.start_date.valueOf()<t.valueOf()
}},multi_day:!0,multi_day_limit:3,views:[],tab_views:[],server_utc:!1,separate_short_events:!0},scheduler.xy={confirm_height:231,confirm_width:250,scale_width:40,min_event_height:20,scale_height:20,week_tab:60,day_tab:60,month_tab:68,icon_today:55,icon_save:90,icon_done:90,icon_cancel:80,icon_edit:90,icon_back:70,list_header_height:30,list_height:50,all_day:120,month_list_height:50},scheduler.templates={day_event_style:function(t){var e="";
if(t.color){var i=webix.color.toRgb(t.color);e+=";border-color:"+t.color+";",e+="background-color:rgba("+i.toString()+",0.3);";var s=webix.color.rgbToHsv(i[0],i[1],i[2]);s[2]/=1.6;var n="rgb("+webix.color.hsvToRgb(s[0],s[1],s[2])+")";e+="color:"+n}return e},multi_day_event_style:function(t){var e="";
if(t.color){var i=webix.color.toRgb(t.color);e+=";background-color:rgba("+i.toString()+",0.3);";var s=webix.color.rgbToHsv(i[0],i[1],i[2]);s[2]/=1.6;var n="rgb("+webix.color.hsvToRgb(s[0],s[1],s[2])+")";e+="color:"+n}return e},selected_event:function(t){var e="",i="",s="",n=t.start_date,a=t.end_date;
if(!n)return e;if(e+="<div  class='selected_event "+scheduler.templates.event_class(t)+"'  >",e+="<div class='event_title'>"+t.text+"</div>",webix.Date.datePart(n,!0).valueOf()==webix.Date.datePart(a,!0).valueOf()){var r=webix.i18n.dateFormatStr(n);i=webix.i18n.timeFormatStr(n),s=webix.i18n.timeFormatStr(a),e+="<div class='event_text'>"+r+"</div>",e+="<div class='event_text'>"+scheduler.locale.labels.label_from+" "+i+" "+scheduler.locale.labels.label_to+" "+s+"</div>"
}else{var h=webix.i18n.longDateFormatStr(n),o=webix.i18n.longDateFormatStr(a);(webix.Date.datePart(n,!0).valueOf()!=n.valueOf()||webix.Date.datePart(a,!0).valueOf()!=a.valueOf())&&(i=webix.i18n.timeFormatStr(n)+" ",s=webix.i18n.timeFormatStr(a)+" "),e+="<div class='event_text'>"+scheduler.locale.labels.label_from+" "+i+h+"</div>",e+="<div class='event_text'>"+scheduler.locale.labels.label_to+" "+s+o+"</div>"
}return t.details&&""!==t.details&&(e+="<div class='event_title'>"+scheduler.locale.labels.label_details+"</div>",e+="<div class='event_text'>"+t.details+"</div>"),e+="</div>"},week_title:function(t){var e=webix.Date.weekStart(t),i=webix.Date.add(e,6,"day",!0);return webix.i18n.headerWeekFormatStr(e)+"&nbsp;-&nbsp;"+webix.i18n.headerWeekFormatStr(i)
},calendar_event:function(t){return"<div class='webix_cal_day_event'>"+t.getDate()+"</div><div class='webix_cal_event_marker'></div>"},event_date:function(t){var e=new Date(parseInt(t,10)),i=webix.Date.datePart(e).valueOf()==webix.Date.datePart(new Date).valueOf();return"<span class='webix_unit_header_inner"+(i?" today":"")+"'>"+webix.i18n.weekDateFormatStr(e)+"</span>"
},event_time:function(t){var e=t.start_date,i=t.end_date;return webix.Date.datePart(e,!0).valueOf()!=e.valueOf()||webix.Date.datePart(i,!0).valueOf()!=i.valueOf()?webix.i18n.timeFormatStr(e):scheduler.locale.labels.label_allday},event_marker:function(t){var e="";if(t.color){var i=webix.color.toRgb(t.color);
e+=";border-color:"+t.color+";",e+="background-color:rgba("+i.toString()+",0.9);"}return"<div class='webix_event_marker' ><div style='"+e+"'></div></div>"},event_title:function(t,e){return"<div class='webix_event_overall "+e.eventClass(t,e)+"'><div class='webix_event_time'>"+e.timeStart(t)+"</div>"+e.marker(t,e)+"<div class='webix_event_text' "+(t.textColor?"style='color:"+t.textColor:"")+"'>"+t.text+"</div></div>"
},month_event_title:function(t,e){return"<div class='webix_event_overall "+e.eventClass(t,e)+"'><div class='webix_event_time'>"+e.timeStart(t)+"</div>"+e.marker(t,e)+"<div class='webix_event_text' "+(t.textColor?"style='color:"+t.textColor:"")+"'>"+t.text+"</div></div>"},day_event:function(t){return t.text
},multi_day_event:function(t){return t.text},new_event_data:function(){var t=webix.Date.add(new Date,1,"hour",!0).getHours(),e=webix.Date.copy(this.coreData.getValue());e.setHours(t);var i=webix.Date.add(e,1,"hour",!0);return{start_date:e,end_date:i}},event_class:webix.template("")},webix.protoUI({name:"datetext",defaults:{template:function(t,e){return e.Fe(t,e)
},icon:"angle-right"},$renderIcon:function(){var t=this.config,e=t.aheight-2*t.inputPadding,i=(e-18)/2-1;return t.icon?"<span style=height:"+(e-i)+"px;padding-top:"+i+"px;' class='webix_input_icon  fa-"+t.icon+"'></span>":""},ye:function(t){webix.isUndefined(t.value)||this.$setValue(t.value)},setValue:function(t,e){var i=this.config.value,s=!0;
return i!=t||(s=!1,e)?(this.config.value=t,this.se&&this.$setValue(t),void(s&&this.callEvent("onChange",[t,i]))):!1},$setValue:function(t){this.config.value=t||"";var e=this.config.dateFormatStr||webix.i18n.dateFormatStr;this.config.text=this.getInputNode().innerHTML="object"==typeof this.config.value?e(this.config.value):this.config.value
},dateFormat_setter:function(t){return this.config.dateFormatStr=webix.Date.dateToStr(t),webix.Date.strToDate(t)},getValue:function(){return this.config.value||null},getInputNode:function(){return this.y.getElementsByTagName("DIV")[1]}},webix.ui.text),webix.protoUI({name:"weekevents",ad:"webix_item_id",on_click:{},render:function(t,e){this.config;
this.isVisible(this.config.id)&&this.callEvent("onBeforeRender",[this.data])&&(this.units=null,this.$h(),this.units&&(e=this._h(),this.y.innerHTML=e.length?e.map(this.jb,this).join(""):"<div class='webix_noevents'>"+this.config.noEvents+"</div>",this.t=null),this.callEvent("onAfterRender",[]))},jb:function(t){return this.callEvent("onItemRender",[t]),t.$unit?this.type.templateStartHeader(t,this.type)+this.type.templateHeader.call(this,t.$unit)+this.type.templateEnd(t,this.type):this.type.templateStart(t,this.type)+(t.$template?this.type["template"+t.$template]:this.type.template)(t,this.type)+this.type.templateEnd(t,this.type)
},_h:function(){var t,e,i,s;t=[];for(i in this.units)for(t.push({$unit:i}),s=this.units[i],e=0;e<s.length;e++){var n=webix.extend({},s[e]);t.push(n)}return webix.toArray(t)},$h:function(){var t=this.getTopParentView(),e=t.coreData.getValue(),i=webix.Date.weekStart(e),s=webix.Date.add(i,1,"week",!0);this.units={};
for(;i.valueOf()<s.valueOf();){var n=webix.Date.add(i,1,"day",!0),a=t.Xv(i,t.getEvents(i,n));a.length&&(this.units[i.valueOf()]=a),i=webix.Date.add(i,1,"day",!0)}},type:{headerHeight:28,templateHeader:function(t){var e=new Date(parseInt(t,10)),i=webix.Date.datePart(e).valueOf()==webix.Date.datePart(new Date).valueOf();
return"<span class='webix_unit_header_inner"+(i?" current":"")+"'>"+webix.i18n.weekDateFormatStr(e)+"</span>"},templateStart:function(t,e){if(t.$unit)return e.templateStartHeader.apply(this,arguments);var i="webix_list_item webix_list_"+e.css+"_item"+(t.$selected?"_selected":""),s="width:auto; height:"+e.height+"px; padding:"+e.padding+"px; margin:"+e.margin+"px; overflow:hidden;"+(e.layout&&"x"==e.layout?"float:left;":"");
return"<div webix_item_id='"+t.id+"' class='"+i+"' style='"+s+"'>"},templateStartHeader:function(t,e){var i="webix_unit_header webix_unit_"+e.css+"_header"+(t.$selected?"_selected":""),s="width:auto; height:"+e.headerHeight+"px; overflow:hidden;";return"<div webix_unit_id='"+t.$unit+"' class='"+i+"' style='"+s+"'>"
}}},webix.ui.list),webix.ready(function(){webix.callEvent("onBeforeSchedulerInit",[]),scheduler.locale&&scheduler.locale.date&&(webix.Date.Locale=scheduler.locale.date);var t=scheduler.config,e=scheduler.locale.labels,i=scheduler.templates;if(t.form||(t.form=[{view:"text",label:e.label_event,labelWidth:90,name:"text"},{view:"datetext",label:e.label_start,labelWidth:90,id:"start_date",name:"start_date",dateFormat:t.form_date},{view:"datetext",label:e.label_end,labelWidth:90,id:"end_date",name:"end_date",dateFormat:t.form_date},{view:"checkbox",id:"allDay",name:"allDay",label:e.label_allday,labelWidth:100,value:0},{view:"textarea",label:e.label_details,name:"details",labelWidth:90,height:150},{}]),!t.calendar_hour){var s=t.hour_date.match(/%[h,H,g,G]/gi),n=t.hour_date.match(/%[a,A]/gi);
t.calendar_hour=s[0]+(n?" "+n[0]:"")}t.bottom_toolbar||(t.bottom_toolbar=[{view:"label",id:"today",name:"today",label:e.icon_today,inputWidth:scheduler.xy.icon_today,align:"center",width:scheduler.xy.icon_today+6},{view:"segmented",id:"buttons",value:t.mode||"week",align:"center",multiview:!0,options:[{id:"day",value:e.day_tab,width:scheduler.xy.day_tab},{id:"week",value:e.week_tab,width:scheduler.xy.week_tab},{id:"month",value:e.month_tab,width:scheduler.xy.month_tab}]},{view:"label",css:"add",name:"add",id:"add",align:"center",label:"&nbsp;+&nbsp;",width:45},{view:"label",label:"",width:45,batch:"readonly"}]),t.day_toolbar||(t.day_toolbar=[{view:"label",id:"prev",align:"left",label:"<div class='webix_cal_prev_button'><div></div></div>"},{view:"label",id:"date",align:"center",width:200},{view:"label",id:"next",align:"right",label:"<div class='webix_cal_next_button'><div></div></div>"}]),t.week_toolbar||(t.week_toolbar=[{view:"label",name:"prevWeek",id:"prevWeek",width:40,align:"left",label:"<div class='webix_cal_prev_button'></div>"},{view:"label",id:"weekTitle",align:"center"},{view:"label",id:"nextWeek",align:"right",label:"<div class='webix_cal_next_button'></div>",width:40}]),t.selected_toolbar||(t.selected_toolbar=[{view:"label",width:scheduler.xy.icon_back,css:"cancel",name:"back",id:"back",align:"center",label:e.icon_back},{view:"button",inputWidth:scheduler.xy.icon_edit,name:"edit",id:"edit",align:"right",label:e.icon_edit}]),t.form_toolbar||(t.form_toolbar=[{view:"label",width:scheduler.xy.icon_cancel,name:"cancel",id:"cancel",css:"cancel",align:"center",label:e.icon_cancel},{view:"button",inputWidth:scheduler.xy.icon_save,name:"save",id:"save",align:"right",label:e.icon_save}]),t.date_toolbar||(t.date_toolbar=[{view:"label",width:scheduler.xy.icon_cancel,name:"cancel_date",id:"cancel_date",css:"cancel",align:"center",label:e.icon_cancel},{view:"label",id:"datetype",align:"center"},{view:"button",width:scheduler.xy.icon_done,name:"done",id:"done",align:"right",label:e.icon_done}]);
var a={cssNoEvents:"no_events",width:"auto",timeStart:i.event_time,marker:i.event_marker,eventClass:i.event_class};scheduler.types={event_list:webix.extend({name:"EventsList",css:"events",headerHeight:scheduler.xy.list_header_height,height:scheduler.xy.list_height,templateHeader:i.event_date,template:i.event_title},a),day_event_list:webix.extend({name:"DayEventsList",css:"day_events",height:scheduler.xy.month_list_height,template:i.month_event_title},a),multi_day_list:{name:"MultiDayEvents",height:32,css:"multi_day_events",templateCss:scheduler.templates.event_class,templateStart:webix.template("<div webix_l_id='#id#' class='webix_list_item {common.templateCss()}' style='width:{common.widthSize()}; height:{common.heightSize()}; overflow:hidden;{common.templateColor()};'>"),template:i.multi_day_event,templateColor:function(t){return scheduler.templates.multi_day_event_style(t)
}}},webix.type(webix.ui.weekevents,scheduler.types.event_list),webix.type(webix.ui.list,scheduler.types.day_event_list),webix.type(webix.ui.list,scheduler.types.multi_day_list),webix.DataDriver.scheduler={records:"/*/event"},webix.extend(webix.DataDriver.scheduler,webix.DataDriver.xml);var r=[{id:"day",rows:[{id:"dayBar",view:"toolbar",css:"webix_topbar",cols:t.day_toolbar},{id:"multiDayList",view:"list",autoheight:!0,type:"MultiDayEvents",yCount:t.multi_day_limit},{id:"dayList",view:"dayevents"}]},{id:"week",rows:[{id:"weekBar",view:"toolbar",css:"webix_topbar",elements:t.week_toolbar},{id:"weekEventsList",view:"weekevents",type:"EventsList",startDate:new Date,noEvents:e.label_no_events}]},{id:"month",view:"scrollview",body:{rows:[{id:"calendar",view:"calendar",width:0,icons:!1,minHeight:310,dayWithEvents:i.calendar_event,calendarHeader:t.calendar_date},{id:"calendarDayEvents",view:"list",height:"auto",scroll:!1,type:"DayEventsList"}]}}].concat(t.tab_views),h={view:"button",height:44,label:e.icon_delete,id:"delete",type:"danger",css:"delete"};
screen.width>500&&(h.width=300,h={type:"clean",cols:[{},h,{}]});var o=[{rows:[{view:"multiview",id:"tabViews",animate:webix.env.touch?{}:!1,cells:r},{id:"bottomBar",css:"webix_bottombar",height:55,padding:5,visibleBatch:"default",cols:t.bottom_toolbar}]},{id:"event",rows:[{id:"eventBar",view:"toolbar",css:"webix_subbar",elements:t.selected_toolbar},{type:"clean",paddingX:10,rows:[{id:"eventTemplate",view:"template",css:"webix_event_view",template:i.selected_event},h,{view:"template",height:20}]}]},{id:"form",rows:[{id:"editBar",view:"toolbar",css:"webix_subbar",elements:t.form_toolbar},{id:"editForm",view:"form",scroll:!0,elements:t.form,rules:t.form_rules}]},{id:"formdate",rows:[{id:"dateBar",view:"toolbar",css:"webix_subbar",elements:t.date_toolbar},{id:"dateForm",type:"clean",rows:[{view:"calendar",height:310,timepickerHeight:35,css:"form_calendar",icons:!1,id:"formCalendar",width:"auto",calendarTime:t.calendar_hour,timepicker:1,hourStart:0},{view:"template",css:"form_template"}]}]}].concat(t.views);
webix.protoUI({name:"scheduler",version:"3.2.2",defaults:{rows:[{view:"multiview",id:"views",animate:webix.env.touch?{}:!1,cells:o}],color:"#color#",textColor:"#textColor#"},$init:function(){this.name="Scheduler",this.x.className+=" webix_scheduler",webix.i18n.dateFormat=t.item_date,webix.i18n.weekDateFormat=t.week_date,webix.i18n.formDate=t.form_date,webix.i18n.formAllDayFormat=t.form_all_day,webix.i18n.timeFormat=t.hour_date,webix.i18n.fullDateFormat=t.parse_date,webix.i18n.fullDateFormatUTC=t.server_utc,webix.i18n.longDateFormat=t.all_day_date,webix.i18n.headerFormatStr=webix.Date.dateToStr(t.day_header_date),webix.i18n.headerWeekFormatStr=webix.Date.dateToStr(t.week_header_date),webix.i18n.loadDateFormat=t.dyn_load_date,webix.i18n.Zi=webix.i18n.Zi.concat(["formDate","formAllDayFormat","loadDateFormat","weekDateFormat"]),webix.i18n.setLocale(),this.data.provideApi(this),this.data.scheme({$init:function(t){"string"==typeof t.start_date&&(t.start_date=webix.i18n.fullDateFormatDate(t.start_date)),"string"==typeof t.end_date&&(t.end_date=webix.i18n.fullDateFormatDate(t.end_date))
},$update:function(t){"string"==typeof t.start_date&&(t.start_date=webix.i18n.fullDateFormatDate(t.start_date)),"string"==typeof t.end_date&&(t.end_date=webix.i18n.fullDateFormatDate(t.end_date))},$serialize:function(t){var e={};return e.start_date=webix.i18n.fullDateFormatStr(webix.Date.copy(t.start_date)),e.end_date=webix.i18n.fullDateFormatStr(webix.Date.copy(t.end_date)),webix.extend(e,t),e
}}),this.$ready.push(this.Yv),webix.callEvent("onAfterSchedulerInit",[this])},syncData:function(t,e,i,s){var n=this.getEvents(e,i),a=t.data.pull={},r=t.data.order=[];n=this.Xv(e,n);for(var h=0;h<n.length;h++)if(!s||s.call(t,n[h],e,i)){var o=n[h].id;r.push(o),a[o]=n[h]}},Zv:function(){this.coreData.callEvent("onChange",[]),this.$$("multiDayList").getParentView().resize()
},getWeekTitle:function(t){return scheduler.templates.week_title(t)},getTodayMultiEvents:function(){var t=this.getTopParentView(),e=webix.Date.datePart(t.coreData.getValue(),!0),i=webix.Date.add(e,1,"day",!0);t.syncData(this,e,i,function(t){var s=webix.Date.datePart(t.start_date,!0),n=webix.Date.datePart(t.end_date,!0);
return!webix.Date.equal(s,n)&&t.start_date.valueOf()<=e.valueOf()&&t.end_date.valueOf()>=i.valueOf()}),this.resize()},getTodayEvents:function(){var e=this.getTopParentView(),i=webix.Date.datePart(e.coreData.getValue(),!0),s=webix.Date.add(i,1,"day",!0),n=null;t.multi_day&&e.$$("dayList").isVisible()&&(n=function(t){var e=webix.Date.datePart(t.start_date,!0),n=webix.Date.datePart(t.end_date,!0);
return webix.Date.equal(e,n)||t.start_date.valueOf()>i.valueOf()||t.end_date.valueOf()<s.valueOf()}),e.syncData(this,i,s,n)},$v:function(){if(this.isVisible()){var t=this.getTopParentView(),e=webix.Date.datePart(webix.Date.copy(this.getVisibleDate()));e.setDate(1);var i=webix.Date.add(e,1,"month",!0);
t._v={};for(var s=t.getEvents(e,i);i>e;){for(var n=webix.Date.add(e,1,"day",!0),a=0;a<s.length;a++)s[a].start_date<n&&s[a].end_date>e&&(t._v[e.valueOf()]=!0);e=n}}},Yv:function(){if(this.aw(),this.bw(),this.coreData=new webix.DataValue,this.coreData.setValue(t.init_date),this.$$("dayList").define("date",this.coreData),this.selectedEvent=new webix.DataRecord,this.config.readonly?this.define("readonly",this.config.readonly):t.readonly&&this.define("readonly",!0),this.$$("date")&&(this.$$("date").setValue(webix.i18n.headerFormatStr(t.init_date)),this.$$("date").config.label=this.$$("date").config.value,this.$$("date").bind(this.coreData,null,webix.i18n.headerFormatStr)),this.$$("weekTitle")){var e=this.getWeekTitle(t.init_date);
this.$$("weekTitle").setValue(e),this.$$("weekTitle").config.label=e,this.$$("weekTitle").bind(this.coreData,null,webix.bind(this.getWeekTitle,this))}this.data.attachEvent("onStoreUpdated",this.dw),this.data.attachEvent("onStoreUpdated",webix.bind(this.Zv,this)),t.multi_day&&(this.$$("multiDayList").define("dataFeed",this.getTodayMultiEvents),this.$$("multiDayList").bind(this.coreData)),this.$$("weekEventsList").bind(this.coreData),this.$$("dayList").define("dataFeed",this.getTodayEvents),this.$$("dayList").bind(this.coreData),this.$$("calendarDayEvents").define("dataFeed",this.getTodayEvents),this.$$("calendarDayEvents").bind(this.coreData),this.$$("calendar").bind(this.coreData),this.$$("calendar").attachEvent("onBeforeRender",this.$v),this.coreData.attachEvent("onChange",webix.bind(function(){this.$$("calendar").Np||(this.ew&&this.fw&&this.load.apply(this,[this.fw]),this.$$("calendar").render())
},this)),this.data.attachEvent("onClearAll",webix.bind(function(){this.gw={}},this)),this.data.attachEvent("onIdChange",webix.bind(function(){this.Zv()},this)),this.$$("eventTemplate").bind(this),this.$$("weekEventsList").attachEvent("onItemClick",webix.bind(this.hw,this)),this.$$("dayList").attachEvent("onItemClick",webix.bind(this.hw,this)),this.$$("multiDayList").attachEvent("onItemClick",webix.bind(this.hw,this)),this.$$("calendarDayEvents").attachEvent("onItemClick",webix.bind(this.hw,this)),this.$$(t.mode||"week").show(!1,!1),this.iw()
},iw:function(){this.$$("editForm").bind(this),this.dateField=new webix.DataValue,this.dateField.setValue("start_date"),this.$$("datetype").bind(this.dateField,null,function(t){return"start_date"==t?e.label_start:e.label_end}),this.$$("formCalendar").attachEvent("onAfterZoom",webix.bind(function(t){t&&this.$$("cancel_date").hide()
},this)),this.$$("formCalendar").attachEvent("onBeforeRender",webix.bind(function(){this.$$("cancel_date").show()},this))},hw:function(t){this.Yt=(t||"").toString().split("#"),this.Yt[1]&&this.setCursor(null),this.setCursor(this.Yt[0]),this.callEvent("onBeforeEventShow",[this.Yt[0]])&&this.$$("event").show()
},dw:function(){this.blockEvent(),this.sort(function(t,e){return t.start_date<e.start_date?-1:1}),this.unblockEvent()},bw:function(){this.$$("calendar").attachEvent("onDateSelect",webix.bind(function(t){this.setDate(t)},this)),this.$$("calendar").attachEvent("onAfterZoom",function(t){t||this.callEvent("onBeforeMonthChange",[null,this.s.date])
}),this.$$("calendar").attachEvent("onBeforeMonthChange",webix.bind(function(t,e){if(!this.$$("calendar").Np){var i=new Date;e.getMonth()===i.getMonth()&&e.getYear()===i.getYear()?e=i:e.setDate(1),this.$$("tabViews").config.animate?webix.ui.animateView(this.$$("month").getBody(),webix.bind(function(){this.setDate(e)
},this),{type:"slide",direction:e>t?"left":"right"}):this.setDate(e)}},this)),this.$$("calendar").config.dayTemplate=webix.bind(function(t){return this._v&&this._v[t.valueOf()]?this.$$("calendar").config.dayWithEvents(t):t.getDate()},this)},getEvents:function(t,e){e||(e=new Date(9999,0,1));for(var i=[],s=this.data.getRange(),n=0;n<s.length;n++)s[n].start_date<e&&s[n].end_date>t&&i.push(webix.copy(s[n]));
return i},Xv:function(t,e){var i,s=[];if(e)for(var n=0;n<e.length;n++){i={start_date:webix.Date.copy(e[n].start_date),end_date:webix.Date.copy(e[n].end_date)},webix.extend(i,e[n]),i.start_date.valueOf()<t.valueOf()&&(i.start_date=webix.Date.add(webix.Date.datePart(i.start_date),1,"day",!0));var a=(a||"").toString().split("#"),r=i.rec_type?new Date(1e3*a[1]+1e3*i.event_length):i.end_date;
r.valueOf()>webix.Date.add(t,1,"day",!0).valueOf()&&(r=webix.Date.datePart(r),i.end_date=webix.Date.add(r,1,"day",!0)),s.push(i)}return s},setDate:function(t,e,i){t=t?webix.Date.datePart(t,!0):this.coreData.getValue(),e&&(t=webix.Date.add(t,e,i,!0)),this.coreData.setValue(t)},aw:function(){this.attachEvent("onItemClick",function(t){var i=this.innerId(t);
switch(i){case"today":this.setDate(new Date);break;case"add":if("form"==this.innerId(this.$$("views").getActiveId())){var s=this;webix.confirm({height:scheduler.xy.confirm_height,width:scheduler.xy.confirm_width,title:e.icon_close,message:e.confirm_closing,callback:function(t){t&&s.jw()},ok:e.icon_yes,cancel:e.icon_no,css:"confirm"})
}else this.jw();break;case"prev":this.setDate(null,-1,"day");break;case"next":this.setDate(null,1,"day");break;case"prevWeek":this.setDate(null,-1,"week");break;case"nextWeek":this.setDate(null,1,"week");break;case"edit":this.kw();break;case"cancel_date":case"back":this.$$("views").back();break;case"cancel":this.callEvent("onAfterCursorChange",[this.getCursor()]),this.$$("views").back();
break;case"save":this.lw();break;case"delete":this.mw();break;case"start_date":case"end_date":"datetext"==this.$$(i).name&&this.nw(i);break;case"done":if(this.$$("formCalendar").Np)this.$$("formCalendar").selectDate(this.$$("formCalendar").config.date,!0);else{var n=this.dateField.getValue(),a=this.$$("formCalendar").getValue();
this.$$(n).setValue(a),this.ow(),this.$$("views").back(),this.$$("editForm").validate()}break;case"allDay":this.pw()}}),this.attachEvent("onAfterTabClick",function(t,e){this.$$(e).show()}),this.attachEvent("onBeforeTabClick",function(t,e){return this.qw(e)})},readonly_setter:function(t){return this.$$("add")&&(t?(this.$$("bottomBar").showBatch("readonly"),this.$$("add").hide(),this.$$("edit").hide(),this.$$("delete").hide()):(this.$$("bottomBar").showBatch("default"),this.$$("add").show(),this.$$("edit").show(),this.$$("delete").show())),t
},rw:function(){this.dataCount()?this.x.className=this.x.className.replace(RegExp(this.type.cssNoEvents,"g"),""):this.x.className+=" "+this.type.cssNoEvents},lw:function(){if(this.$$("editForm").validate()){if(this.config.editEvent)this.$$("editForm").save();else{var t=this.$$("editForm").getValues();
t.id=webix.uid(),t.details&&""===this.Dn(t.text)&&""!==this.Dn(t.details)&&(t.text=t.details),this.add(t),this.setCursor(t.id)}this.setDate(),this.$$("views").back()}},mw:function(){var t=this;webix.confirm({height:scheduler.xy.confirm_height,width:scheduler.xy.confirm_width,title:e.icon_delete,text:e.confirm_deleting,callback:function(e){e&&(t.remove(t.getCursor()),t.setDate(),t.$$("views").back(1))
},ok:e.icon_yes,cancel:e.icon_no,css:"confirm",header:!1})},jw:function(){this.define("editEvent",!1),this.$$("form").show(),this.$$("editForm").clear(),this.$$("editForm").clearValidation(),this.$$("editForm").setValues(i.new_event_data.call(this)),this.ow()},eventDefaultDate:function(){},kw:function(){this.$$("delete")&&this.$$("delete").show(),this.define("editEvent",!0),this.$$("form").show(),this.$$("rec_type")&&this.$$("rec_type").setValue(this.$$("rec_type").getValue(),!0),this.ow()
},qw:function(t){if("form"==this.innerId(this.$$("views").getActiveId())){var i=this;return"today"!=t&&webix.confirm({height:scheduler.xy.confirm_height,width:scheduler.xy.confirm_width,title:e.icon_close,text:e.confirm_closing,callback:function(e){e&&(i.$$(t).show(),i.$$("buttons").setValue(t))},labelOk:e.icon_yes,labelCancel:e.icon_no,css:"confirm"}),!1
}return!0},nw:function(t){this.dateField.setValue(t),this.$$("editForm").elements.allDay&&this.$$("formCalendar").define("timepicker",!this.$$("editForm").elements.allDay.getValue()),this.$$("formdate").show(),webix.delay(function(){this.$$("formCalendar").resize(),this.$$("formCalendar").selectDate(webix.Date.copy(this.$$(t).getValue()),!0)
},this)},sw:function(t){return t.valueOf()==webix.Date.datePart(t,!0).valueOf()},pw:function(){for(var t="1"==this.$$("allDay").getValue()?webix.i18n.formAllDayFormatStr:webix.i18n.formDateStr,e=this.$$("editForm").elements,i=[this.$$("start_date"),this.$$("end_date")],s=0;2>s;s++)i[s].config.dateFormatStr=t,1!=e.allDay.getValue()&&i[s].setValue(this.tw[s],!0);
if(1==e.allDay.getValue()){i[0].setValue(webix.Date.datePart(this.tw[0],!0),!0);var n=webix.Date.datePart(this.tw[1],!0);n.valueOf()<=i[0].getValue().valueOf()&&(n=webix.Date.add(n,1,"day",!0)),i[1].setValue(n,!0)}},ow:function(){this.tw=[];var t=this.$$("editForm").elements;this.tw[0]=this.$$("start_date").getValue(),this.tw[1]=this.$$("end_date").getValue();
var e=this.sw(this.tw[0])&&this.sw(this.tw[1])&&this.tw[1].valueOf()>this.tw[0].valueOf()?1:0;if(t.allDay){t.allDay.setValue(e);for(var i=t.allDay.getValue()?webix.i18n.formAllDayFormatStr:webix.i18n.formDateStr,s=[this.$$("start_date"),this.$$("end_date")],n=0;2>n;n++)s[n].config.dateFormatStr=i,s[n].setValue(this.tw[n],!0)
}},Dn:function(t){return t=t.replace(/^ */g,""),t=t.replace(/ *$/g,"")},setLoadMode:function(t){"all"==t&&(t=""),this.ew=t},gw:{},load:function(t){this.fw=t;var e=arguments;if(this.ew&&"string"==typeof t){t+=(-1==t.indexOf("?")?"?":"&")+"timeshift="+(new Date).getTimezoneOffset();var i,s=s||this.coreData.getValue(),n=webix.i18n.loadDateFormatStr;
s=webix.Date[this.ew+"Start"](new Date(s.valueOf())),i=s,i=webix.Date.add(i,1,this.ew,!0),this.gw[n(s)]&&(s=webix.Date.add(s,1,this.ew,!0));var a=i;do i=a,a=webix.Date.add(i,-1,this.ew,!0);while(a>s&&this.gw[n(a)]);if(s>=i)return!1;for(e[0]=t+"&from="+n(s)+"&to="+n(i);i>s;)this.gw[n(s)]=!0,s=webix.Date.add(s,1,this.ew,!0)
}webix.DataLoader.prototype.load.apply(this,e)}},webix.IdSpace,webix.DataLoader,webix.ui.layout,webix.EventSystem,webix.Settings)}),function(){var t=scheduler.locale.labels,e=scheduler.xy,i=scheduler.config,s=scheduler.templates;i.recurring=!1,i.endless_date=new Date(9999,1,1),i.recurring_dialogs=!1,t.recurring={none:"Never",daily:"Daily",day:"day(s)",every:"Every",weekly:"Weekly",week:"week(s) on",each:"Each",on_day:"on the",monthly:"Monthly",month:"month(s)",month_day:"on what day of the month",week_day:"on what day of the week",yearly:"Yearly",year:"year(s) in",counters:["the first","the second","the third","the fourth","the fifth"],never:"Never",repeat:"Repeat",end_repeat:"End repeat",endless_repeat:"Endless repeat",end_repeat_label:"Repeat will end by",edit_message:"Do you want to edit the whole set of repeated events?",edit_series:"Edit series",edit_occurrence:"Edit occurrence",delete_message:"Do you want to delete the whole set of repeated events?",delete_series:"Delete series",delete_occurrence:"Delete occurrence"},e.recurring={label_end_repeat:140,label_end_by:240,label_every:65,work_days:180},webix.protoUI({name:"datecells",defaults:{css:"webix_datecells",x_count:7,cellHeight:36},ad:"webix_d_c",$init:function(){this.y=this.x
},on_click:{webix_cal_day_num:function(t,e){e&&this.define("activeCell",e)}},activeCell_setter:function(t){return this.s.activeCell=t,this.render(),t},render:function(){if(this.isVisible(this.s.id)){var t=1,e='<table cellspacing="0" cellpadding="0" class="webix_rec_table"><tbody>',i=this.s.data,s=this.$width/this.s.x_count;
for(var n in i){var a="",r="webix_cal_day_num";a+=";height:"+this.s.cellHeight+"px;line-height:"+this.s.cellHeight+"px;",t%this.s.x_count==1&&(e+="<tr>"),e+="<td style='"+(s?"width:"+s+"px":"")+"'>",this.s.activeCell==n&&(r+=" webix_cal_selected_day"),e+="<div webix_d_c='"+n+"' class='"+r+"' style='"+a+"'>"+i[n]+"</div>",e+="</td>",t%this.s.x_count===0&&(e+="</tr>"),t++
}e+="</tbody></table>",this.x.innerHTML=e}},$setSize:function(t,e){webix.ui.view.prototype.$setSize.call(this,t,e)&&this.render()},setValue:function(t){this.define("activeCell",t)},getValue:function(){return this.s.activeCell}},webix.MouseEvents,webix.ui.view,webix.EventSystem),webix.protoUI({name:"rectext",$setValue:function(e){this.s.value=e||"";
var i="none",s=this.getTopParentView().$$("recurring"),n=this.s.value.split("_");""!==n[0]&&(i=s.s.typeToId[n[0]]),this.s.text=this.getInputNode().innerHTML=t.recurring[i]}},webix.ui.datetext),webix.protoUI({name:"endrec",setValue:function(t){var e=!1,i=this.s.value;i==t?e=!0:this.s.value=t,this.se&&this.$setValue(t),e||this.callEvent("onChange",[t,i])
},$setValue:function(e){this.s.value=e||"";var i,s=this.getTopParentView().$$("recurring");"object"==typeof e&&(i=e.valueOf()==s.s.endlessDate.valueOf()?t.recurring.never:(this.s.dateFormatStr||webix.i18n.dateFormatStr)(this.s.value)),this.s.text=this.getInputNode().innerHTML=i||this.s.value}},webix.ui.datetext),webix.protoUI({name:"reclist",defaults:{},$init:function(){this.$view.className+=" webix_reclist"
},setValue:function(t){this.getItem(t)&&this.select(t)},getValue:function(){return this.getSelected()}},webix.ui.list),webix.protoUI({name:"daily",setValue:function(t){"object"==typeof t&&"day"==t[0]&&(t[1]&&""!==t[1]||(t[1]=1),this.setValues({dayCount:t[1]}))},getValue:function(){var t=this.getValues();
return["day",t.dayCount,"","","",""]}},webix.ui.form),webix.protoUI({name:"weekly",setValue:function(t){"object"==typeof t&&"week"==t[0]&&(t[1]||""!==t[1]||(t[1]=1),t[4]&&""!==t[4]||(t[4]=(t[5].getDay()+6)%7+1),this.setValues({weekCount:t[1],weekDays:""+t[4]}))},getValue:function(){var t=this.getValues();
return t.weekDays||(t.weekDays=1),["week",t.weekCount,"","",t.weekDays,""]}},webix.ui.form),webix.protoUI({name:"monthly",defaults:{css:"webix_monthly"},setValue:function(t){if("object"==typeof t&&"month"==t[0]){var e=this.getTopParentView();t[1]||""!==t[1]||(t[1]=1),t[2]&&""!==t[2]?e.$$("typeWeekM").expand():(t[2]=(t[5].getDay()+6)%7+1,t[3]=Math.ceil(t[5].getDate()/7)),this.setValues({monthCount:t[1],weekDayM:t[2],weekCountM:t[3],monthDayM:t[5].getDate()})
}},getValue:function(){var t=this.getValues(),e=["month",t.monthCount,"","","",""],i=this.getTopParentView();return i.$$("typeDayM").s.collapsed?(e[2]=t.weekDayM,e[3]=t.weekCountM):e[5]=t.monthDayM,e}},webix.ui.form),webix.protoUI({name:"yearly",defaults:{css:"webix_yearly"},setValue:function(t){if("object"==typeof t&&"year"==t[0]){var e=this.getTopParentView();
t[1]||""!==t[1]||(t[1]=1),t[2]&&""!==t[2]?e.$$("typeWeekY").setValue(1):(e.$$("typeWeekY").setValue(0),t[2]=(t[5].getDay()+6)%7+1,t[3]=Math.ceil(t[5].getDate()/7)),e.$$("typeWeekY").callEvent("onItemClick",[]),this.setValues({yearCount:t[1],weekDayY:t[2],weekCountY:t[3],monthDayY:t[5].getMonth()})}},getValue:function(){var t=this.getValues(),e=["year",t.yearCount,"","","",""],i=this.getTopParentView();
return i.$$("typeWeekY").getValue()&&(e[2]=t.weekDayY,e[3]=t.weekCountY),e[5]=t.monthDayY,e}},webix.ui.form),webix.protoUI({name:"rec_dialog",defaults:{height:210,css:"webix_scheduler dialog",head:!1,body:{type:"clean",rows:[{id:"webix_confirm_message",template:"<div class='webix_dialog_text'>#text#</div>",data:{text:"You have forgot to define the text :) "}},{height:44,view:"button",label:"Series",click:function(){this.getParentView().getParentView().wr(1)
}},{height:44,view:"button",label:"Occurrence",click:function(){this.getParentView().getParentView().wr(2)}},{height:44,view:"button",css:"cancel",label:"Cancel",click:function(){this.getParentView().getParentView().wr(!1)}}]}},labelSeries_setter:function(t){var e=this.gd.q[1];e.config.label=t,e.render()
},labelEvent_setter:function(t){var e=this.gd.q[2];e.config.label=t,e.render()},labelCancel_setter:function(t){var e=this.gd.q[3];e.config.label=t,e.render()}},webix.ui.alert),webix.rec_dialog=webix.single(webix.ui.rec_dialog),webix.attachEvent("onAfterSchedulerInit",function(s){return i.recurring?(webix.delay(function(){s.$$("editForm").define("dataFeed",function(t){t=webix.copy(this.getTopParentView().getItem(t)),delete t.id,t.rec_type&&(t.endRepeat=t.end_date,t.end_date=new Date(t.start_date.valueOf()+1e3*t.event_length)),this.setValues(t)
}),s.$$("editForm").getValueBase=s.$$("editForm").getValues,s.$$("editForm").getValues=function(){var t=this.getValueBase();return t.rec_type&&(t.event_length=Math.round((t.end_date-t.start_date)/1e3),t.end_date=t.endRepeat||t.end_date),t}}),s.getEventsBase=s.getEvents,s.getEvents=function(t,e){e=e||webix.Date.add(t,1,"month",!0);
for(var i=this.getEventsBase(t,e),s=[],n=0;n<i.length;n++)i[n].rec_type?this.repeat_date(i[n],s,t,e):s.push(i[n]);return s.sort(function(t,e){return t=t.start_date,e=e.start_date,t>e?1:e>t?-1:0}),s},s.uw=s.lw,s.lw=function(){if(!this.s.editEvent&&this.$$("editForm").validate()){var t=this.$$("editForm").getValues();
if(t.event_pid)return t.id=webix.uid(),t.details&&""===this.Dn(t.text)&&""!==this.Dn(t.details)&&(t.text=t.details),t.event_length=t.start_date.valueOf()/1e3,this.vw(t,t.start_date.valueOf()),this.add(t),this.setCursor(t.id),this.setDate(),this.$$("views").back(),!0}this.uw.call(this)},s.ww=s.kw,s.kw=function(){var n=this.getItem(this.getCursor());
(n.rec_type||n.event_pid)&&i.recurring_dialogs?webix.rec_dialog({height:e.confirm_height,width:e.confirm_width,message:t.recurring.edit_message,callback:function(t){1==t?(n.event_pid&&s.setCursor(n.event_pid),s.ww.call(s)):2==t&&s.xw("edit")},labelSeries:t.recurring.edit_series,labelEvent:t.recurring.edit_occurrence,labelCancel:t.icon_cancel}):s.ww.call(this)
},s.yw=s.mw,s.mw=function(){var n=this.getItem(this.getCursor());(n.rec_type||n.event_pid)&&i.recurring_dialogs?webix.rec_dialog({height:e.confirm_height,width:e.confirm_width,message:t.recurring.delete_message,callback:function(t){1==t?(s.remove(s.getCursor()),s.setDate(),s.$$("views").back(1)):2==t&&s.xw("remove")
},labelSeries:t.recurring.delete_series,labelEvent:t.recurring.delete_occurrence,labelCancel:t.icon_cancel}):s.yw.call(this)},s.xw=function(t){if("edit"==t){var e=webix.copy(this.getItem(this.getCursor()));if(e.rec_type){this.define("editEvent",!1),this.$$("rec_type")&&!this.$$("rec_type").config.hidden&&(this.zw="hide"),this.$$("form").show(),this.$$("editForm").clear(),e.event_pid=e.id;
var i=this.Yt;if(!i&&!i[1])return s.ww.call(this);{e.start_date,e.end_date}e.start_date=new Date(1e3*i[1]),e.end_date=new Date(1e3*i[1]+1e3*e.event_length),delete e.id,e.rec_type=e.rec_pattern="",e.end_date=new Date(e.start_date.valueOf()+1e3*e.event_length),this.$$("editForm").setValues(e),this.ow()
}else s.ww.call(this)}else if("remove"==t){var e=webix.copy(this.getItem(this.getCursor()));e.event_pid=e.id;var i=this.Yt;if(!i||!i[1])return;{e.start_date,e.end_date}e.start_date=new Date(1e3*i[1]),e.end_date=new Date(1e3*i[1]+1e3*e.event_length),e.id=webix.uid(),e.rec_type=e.rec_pattern="none",e.end_date=new Date(e.start_date.valueOf()+1e3*e.event_length),e.event_length=e.start_date.valueOf()/1e3,this.vw(e,e.start_date.valueOf()),this.add(e),this.setDate(),this.$$("views").back()
}},s.Aw={},s.Bw={},s.vw=function(t,e){t.Cw=e,this.Aw[t.id]=t,this.Bw[t.event_pid]||(this.Bw[t.event_pid]={}),this.Bw[t.event_pid][e]=t},s.Dw=function(t,e){var i=this.Bw[e];return i?i[t]:null},s.Ew=function(t){return this.Bw[t]||[]},s.data.scheme({$init:function(t){"string"==typeof t.start_date&&(t.start_date=webix.i18n.fullDateFormatDate(t.start_date)),"string"==typeof t.end_date&&(t.end_date=webix.i18n.fullDateFormatDate(t.end_date)),t.event_pid&&s.vw(t,1e3*t.event_length)
},$serialize:function(t){var e={};return e.start_date=webix.i18n.fullDateFormatStr(webix.Date.copy(t.start_date)),e.end_date=webix.i18n.fullDateFormatStr(webix.Date.copy(t.end_date)),webix.extend(e,t),e}}),s.transponse_size={day:1,week:7,month:1,year:12},s.day_week=function(t,e,i){t.setDate(1),i=7*(i-1);
var s=t.getDay(),n=(7==e?0:1*e)+i-s+1;t.setDate(i>=n?n+7:n)},s.transpose_day_week=function(t,e,i,n,a){for(var r=(t.getDay()||(webix.Date.startOnMonday?7:0))-i,h=0;h<e.length;h++)if(e[h]>r)return t.setDate(t.getDate()+1*e[h]-r-(n?i:a));s.transpose_day_week(t,e,i+n,null,i)},s.transpose_type=function(t){var e="transpose_"+t;
if(!webix.Date[e]){var i=t.split("_"),n=864e5,a=s.transponse_size[i[0]]*i[1];if("day"==i[0]||"week"==i[0]){var r=null;if(i[4]&&(r=i[4].split(","),webix.Date.startOnMonday)){for(var h=0;h<r.length;h++)r[h]=1*r[h]||7;r.sort()}webix.Date[e]=function(t,e){var i=Math.floor((e.valueOf()-t.valueOf())/(n*a));
i>0&&t.setDate(t.getDate()+i*a),r&&s.transpose_day_week(t,r,1,a)},webix.Date.add[t]=function(t,e){if(r)for(var i=0;e>i;i++)s.transpose_day_week(t,r,0,a);else t.setDate(t.getDate()+e*a);return t}}else("month"==i[0]||"year"==i[0])&&(webix.Date[e]=function(t,e){var n=Math.ceil((12*e.getFullYear()+1*e.getMonth()-(12*t.getFullYear()+1*t.getMonth()))/a);
n>=0&&t.setMonth(t.getMonth()+n*a),i[3]&&s.day_week(t,i[2],i[3])},webix.Date.add[t]=function(t,e){return t.setMonth(t.getMonth()+e*a),i[3]&&s.day_week(t,i[2],i[3]),t})}},s.data.attachEvent("onStoreUpdated",function(t,e,i){if("delete"==i||"update"==i||"insert"==i&&!e.rec_type&&e.event_pid){this.blockEvent();
var n=s.Ew(t);s.Bw[t]=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a].id,this.getItem(t)&&this.remove(t));this.unblockEvent()}}),void(s.repeat_date=function(t,e,i,n){if("none"!=t.rec_type){var a=new Date(t.start_date.valueOf());for(t.rec_pattern=t.rec_type.split("#")[0],s.transpose_type(t.rec_pattern),webix.Date["transpose_"+t.rec_pattern](a,i);a<t.start_date||a.valueOf()+1e3*t.event_length<=i.valueOf();)a=webix.Date.add(a,1,t.rec_pattern,!0);
for(;n>a&&a<t.end_date;){var r=this.Dw(a.valueOf(),t.id);if(!r){var h=new Date(a.valueOf()+1e3*t.event_length),o=webix.copy(t);o.text=t.text,o.start_date=a,o.event_pid=t.id,o.id=t.id+"#"+Math.ceil(a.valueOf()/1e3),o.end_date=h;var l=o.start_date.getTimezoneOffset()-o.end_date.getTimezoneOffset();l&&(o.end_date=new Date(l>0?a.valueOf()+1e3*t.event_length-60*l*1e3:o.end_date.valueOf()+60*l*1e3)),e.push(o)
}a=webix.Date.add(a,1,t.rec_pattern,!0)}}})):!1}),webix.attachEvent("onBeforeSchedulerInit",function(){if(!i.recurring)return!0;i.form||(i.form=[{view:"text",label:t.label_event,name:"text",labelWidth:90},{view:"datetext",label:t.label_start,id:"start_date",name:"start_date",dateFormat:i.form_date,labelWidth:90},{view:"datetext",label:t.label_end,id:"end_date",name:"end_date",dateFormat:i.form_date,labelWidth:90},{view:"checkbox",id:"allDay",name:"allDay",label:t.label_allday,value:0,labelWidth:100},{view:"rectext",label:t.recurring.repeat,id:"rec_type",name:"rec_type",readonly:!0,labelWidth:90},{view:"textarea",label:t.label_details,id:"details",name:"details",height:110,labelWidth:90},{view:"text",hidden:!0,id:"event_length",name:"event_length"}]),i.recurring_bar||(i.recurring_bar=[{view:"label",width:e.icon_cancel,id:"recCancel",name:"recCancel",css:"cancel",align:"center",label:t.icon_cancel,batch:"default"},{view:"label",width:e.icon_cancel,id:"recEndCancel",name:"recEndCancel",css:"cancel",align:"center",label:t.icon_cancel,batch:"endRepeat"},{},{view:"button",width:e.icon_done,id:"recDone",name:"recDone",align:"right",label:t.icon_done,batch:"default"},{view:"button",width:e.icon_done,id:"recDone2",name:"recDone2",align:"right",label:t.icon_done,batch:"other"},{view:"button",width:e.icon_done,id:"recEndDone",name:"recEndDone",align:"right",label:t.icon_done,batch:"endRepeat"}]),i.recurring_views_list||(i.recurring_views_list=[{id:"none",value:t.recurring.none,readonly:!0},{id:"daily",value:t.recurring.daily},{id:"weekly",value:t.recurring.weekly},{id:"monthly",value:t.recurring.monthly},{id:"yearly",value:t.recurring.yearly}]),scheduler.templates.rec_list_item||(scheduler.templates.rec_list_item=function(t){return t.value+(t.readonly?"":"<div class='webix_arrow_icon'></div>")
}),i.rec_init_form||(i.rec_init_form=[{height:10},{view:"reclist",id:"recList",autoheight:!0,scroll:!1,select:!0,css:"rec_list",value:"none",template:scheduler.templates.rec_list_item,datatype:"json",data:i.recurring_views_list,labelWidth:100},{maxHeight:42},{view:"endrec",id:"endRepeat",name:"endRepeat",labelWidth:e.recurring.label_end_repeat,label:t.recurring.end_repeat},{}]),i.end_repeat_form||(i.end_repeat_form=[{type:"clean",paddingX:10,paddingY:5,cols:[{view:"radio",css:"webix_endby_radio",vertical:!0,id:"endBy",width:290,labelWidth:e.recurring.label_end_by,height:80,options:[{value:t.recurring.endless_repeat,id:"0"},{value:t.recurring.end_repeat_label,id:"1"}]},{}]},{view:"calendar",id:"endByDate",width:0,css:"end_rep_calendar",icons:!1},{}]),i.daily_form||(i.daily_form=[{type:"clean",css:"webix_rec_counter",cols:[{view:"label",label:t.recurring.every,width:e.recurring.label_every},{view:"counter",id:"dayCount",name:"dayCount",value:1,width:125},{view:"label",label:t.recurring.day}]},{}]),s.selected_event_base=s.selected_event,s.selected_event=function(t,e){if(t.rec_type){var i=e.getTopParentView().Yt;
if(!i||!i[1])return s.selected_event_base(t);var n=t.start_date,a=t.end_date;t.start_date=new Date(1e3*i[1]),t.end_date=new Date(1e3*i[1]+1e3*t.event_length);var r=s.selected_event_base(t);return t.start_date=n,t.end_date=a,r}return s.selected_event_base(t)},webix.protoUI({name:"weeklist",defaults:{css:"webix_weeklist",elementsConfig:{labelWidth:2},rows:[{view:"checkbox",name:1,id:1,labelRight:webix.i18n.calendar.dayFull[1]},{view:"checkbox",name:2,id:2,labelRight:webix.i18n.calendar.dayFull[2]},{view:"checkbox",name:3,id:3,labelRight:webix.i18n.calendar.dayFull[3]},{view:"checkbox",name:4,id:4,labelRight:webix.i18n.calendar.dayFull[4]},{view:"checkbox",name:5,id:5,labelRight:webix.i18n.calendar.dayFull[5]},{view:"checkbox",name:6,id:6,labelRight:webix.i18n.calendar.dayFull[6]},{view:"checkbox",name:7,id:7,labelRight:webix.i18n.calendar.dayFull[0]}]},getValue:function(){var t=this.getValues(),e=[];
for(var i in t)t[i]&&e.push(i);return e.join()},setValue:function(t){for(var e={},i=1;8>i;i++)e[i]=0;"object"!=typeof t&&(t=t.split(","));for(var i=0;i<t.length;i++)e[parseInt(t[i],10)]=1;this.setValues(e)}},webix.MouseEvents,webix.EventSystem,webix.ui.form),i.weekly_form||(i.weekly_form=[{height:10},{type:"clean",css:"webix_rec_counter",paddingX:8,cols:[{view:"label",borderless:!0,label:t.recurring.every,width:e.recurring.label_every},{view:"counter",id:"weekCount",name:"weekCount",value:1,width:125},{view:"label",label:t.recurring.week}]},{view:"weeklist",id:"weekDays",name:"weekDays"},{}]);
for(var n={},a=1;32>a;a++)n[a]=a;scheduler.templates.rec_month_d||(scheduler.templates.rec_month_d=function(){return"<div class='radio'><div class='on'></div></div><div class='text'>"+t.recurring.month_day+"</div>"}),scheduler.templates.rec_month_w||(scheduler.templates.rec_month_w=function(){return"<div class='radio'><div class='on'></div></div><div class='text'>"+t.recurring.week_day+"</div>"
}),scheduler.templates.rec_month_d_blured||(scheduler.templates.rec_month_d_blured=function(){return"<div class='radio blured'></div><div class='text'>"+t.recurring.month_day+"</div>"}),scheduler.templates.rec_month_w_blured||(scheduler.templates.rec_month_w_blured=function(){return"<div class='radio blured'></div><div class='text'>"+t.recurring.week_day+"</div>"
}),i.week_day_counters||(i.week_day_counters=[{id:1,value:t.recurring.counters[0]},{id:2,value:t.recurring.counters[1]},{id:3,value:t.recurring.counters[2]},{id:4,value:t.recurring.counters[3]},{id:5,value:t.recurring.counters[4]}]),i.week_day_labels||(i.week_day_labels=[{id:1,value:webix.i18n.calendar.dayFull[1]},{id:2,value:webix.i18n.calendar.dayFull[2]},{id:3,value:webix.i18n.calendar.dayFull[3]},{id:4,value:webix.i18n.calendar.dayFull[4]},{id:5,value:webix.i18n.calendar.dayFull[5]},{id:6,value:webix.i18n.calendar.dayFull[6]},{id:7,value:webix.i18n.calendar.dayFull[0]}]),i.monthly_form||(i.monthly_form=[{type:"clean",paddingX:10,cols:[{view:"label",label:t.recurring.every,width:e.recurring.label_every},{view:"counter",id:"monthCount",name:"monthCount",value:1,width:125},{view:"label",label:t.recurring.month},{view:"text",hidden:!0,name:"monthType",value:"Day",width:1}]},{view:"accordion",id:"monthTypeSelect",rows:[{headerAltHeight:50,headerHeight:50,id:"typeDayM",header:scheduler.templates.rec_month_d,headerAlt:scheduler.templates.rec_month_d_blured,body:{view:"datecells",id:"monthDayM",name:"monthDayM",data:n}},{headerAltHeight:50,headerHeight:50,id:"typeWeekM",header:scheduler.templates.rec_month_w,headerAlt:scheduler.templates.rec_month_w_blured,collapsed:!0,body:{type:"clean",rows:[{height:10},{type:"clean",paddingX:10,cols:[{view:"select",value:1,id:"weekCountM",name:"weekCountM",css:"",options:i.week_day_counters},{view:"select",value:1,id:"weekDayM",name:"weekDayM",css:"",options:i.week_day_labels}]},{}]}}]}]),i.year_months||(i.year_months=scheduler.locale.date?scheduler.locale.date.month_short:webix.i18n.calendar.monthShort),i.yearly_form||(i.yearly_form=[{type:"clean",cols:[{view:"label",label:t.recurring.every,width:e.recurring.label_every},{view:"counter",id:"yearCount",name:"yearCount",value:1,width:125},{view:"label",label:t.recurring.year}]},{view:"datecells",id:"monthDayY",borderless:!0,data:i.year_months,x_count:4,height:130},{view:"checkbox",label:t.recurring.week_day,id:"typeWeekY",name:"typeWeekY",labelWidth:250,value:1},{id:"yearWeekRow",type:"clean",cols:[{view:"select",value:1,id:"weekCountY",name:"weekCountY",options:i.week_day_counters},{view:"select",value:1,id:"weekDayY",name:"weekDayY",options:i.week_day_labels}]},{}]),i.recurring_views||(i.recurring_views=[{id:"recForm",view:"form",css:"webix_rec_form",padding:0,scroll:!1,elements:i.rec_init_form},{id:"endRepeatForm",view:"form",type:"clean",elements:i.end_repeat_form},{id:"daily",view:"daily",elements:i.daily_form},{id:"weekly",view:"weekly",type:"clean",elements:i.weekly_form},{id:"monthly",view:"monthly",elements:i.monthly_form,margin:10},{id:"yearly",view:"yearly",padding:10,margin:10,type:"clean",elements:i.yearly_form}]),i.views.push({view:"recurring",id:"recurring"}),webix.protoUI({name:"recurring",defaults:{padding:0,rows:[{view:"toolbar",id:"reccuringBar",css:"webix_subbar",elements:i.recurring_bar,visibleBatch:"default"},{id:"recViews",animate:!1,cells:i.recurring_views}],typeToId:{day:"daily",week:"weekly",month:"monthly",year:"yearly"},endlessDate:i.endless_date},$init:function(){this.name="Recurring",this.$view.className+=" webix_recurring",this.$ready.push(this.Fw)
},Fw:function(){var t={};for(var e in this.s.typeToId)t[this.s.typeToId[e]]=e;this.define("idToType",t),webix.delay(function(){var t=this.getTopParentView();t.$$("rec_type").attachEvent("onItemClick",this.Gw),t.$$("reccuringBar").attachEvent("onItemClick",webix.bind(function(t){switch(t=this.innerId(t)){case"recDone2":case"recEndCancel":this.$$("recViews").back(),this.$$("reccuringBar").showBatch("default");
break;case"recCancel":this.$$("views").back();break;case"recDone":this.$$("recurring").Hw(),this.$$("views").back();break;case"recEndDone":var e;e="1"==this.$$("endBy").getValue()?this.$$("endByDate").getValue():this.$$("recurring").s.endlessDate,this.$$("endRepeat").setValue(e),this.$$("recViews").back(),this.$$("reccuringBar").showBatch("default")
}},t)),t.$$("recList").attachEvent("onItemClick",webix.bind(this.Iw,t)),t.$$("endRepeat").attachEvent("onItemClick",webix.bind(function(){this.Iw.call(t,"endRepeatForm"),t.$$("reccuringBar").showBatch("endRepeat"),this.Jw()},this)),t.$$("typeWeekY")&&t.$$("typeWeekY").attachEvent("onItemClick",function(){this.getValue()?t.$$("yearWeekRow").show():t.$$("yearWeekRow").hide()
}),t.$$("endBy")&&t.$$("endBy").attachEvent("onItemClick",function(){"1"==this.getValue()?t.$$("endByDate").show():t.$$("endByDate").hide()}),t.$$("editForm").attachEvent("onItemClick",webix.bind(function(t){t=this.innerId(t),"end_date"==t&&this.nw(t)},t)),t.$$("weekly").elements.weekDays=t.$$("weekDays"),t.$$("monthly").elements.monthDayM=t.$$("monthDayM"),t.$$("yearly").elements.monthDayY=t.$$("monthDayY"),t.$$("editForm").elements.endRepeat=t.$$("endRepeat"),t.$$("views").attachEvent("onViewChange",function(e,i){t.zw&&t.$$("form").config.id==i&&("hide"==t.zw?(t.$$("rec_type").hide(),t.zw="show"):"show"==t.zw&&t.$$("rec_type").show())
})},this)},Gw:function(){var t=this.getTopParentView();t.$$("recurring").show(),t.$$("recForm")&&(t.$$("recForm").show(),t.$$("recurring").setValue(),t.$$("endRepeat").setValue(t.$$("endRepeat").config.value))},Iw:function(t){this.$$(t)&&(this.$$(t).show(),this.$$("reccuringBar").showBatch("other")),this.$$("endRepeat").getValue()||this.$$("endRepeat").setValue(this.$$("recurring").s.endlessDate)
},setValue:function(t){var e=this.getTopParentView();t=t||e.getItem(e.getCursor());var i=(e.$$("rec_type").getValue()||"_____").split("_"),s=e.$$("recurring").s;e.$$("recList").setValue(i[0]&&""!==i[0]?s.typeToId[i[0]]:"none");var n,a=e.$$("start_date").getValue();for(var r in s.typeToId)r==i[0]?(i.push(a),n=webix.copy(i)):n=[r,1,"","","",a],e.$$(s.typeToId[r]).setValue(n)
},getValue:function(){var t=this.getTopParentView(),e=t.$$("recList").getSelectedId();return"none"==e?["","","","","",""]:t.$$(e).getValue()},Hw:function(){var t=this.getTopParentView(),e=this.getValue(),i=t.$$("start_date").getValue(),s=t.$$("end_date").getValue(),n=s.valueOf()-i.valueOf();if(t.$$("event_length").setValue(n/1e3),!e[0])return t.$$("endRepeat").setValue(t.$$("end_date").getValue()),t.$$("rec_type").setValue(""),void t.$$("event_length").setValue("");
"week"==e[0]?i=webix.Date.add(i,-1*(i.getDay()+6)%7,"day",!0):"month"==e[0]?e[5]&&i.setDate(e[5]):"year"==e[0]&&e[5]&&i.setMonth(e[5]),t.$$("start_date").setValue(i),t.$$("end_date").setValue(new Date(i.valueOf()+n)),e.pop();var a="";"0"==t.$$("endBy").getValue()&&(a="no"),t.$$("rec_type").setValue(e.join("_")+"#"+a)
},Jw:function(){var t=this.getTopParentView(),e=t.$$("editForm").getValues(),i=e.end_date;i.valueOf()==this.s.endlessDate.valueOf()?(t.$$("endBy").setValue("0"),t.$$("endByDate").setValue(scheduler.config.end_by||webix.Date.add(t.$$("end_date").getValue(),1,"year",!0),!0)):(t.$$("endBy").setValue("1"),t.$$("endByDate").define("minDate",i),t.$$("endByDate").setValue(i)),this.Kw()
},Kw:function(){var t=this.getTopParentView(),e=t.$$("endBy").getValue();"1"==e?t.$$("endByDate").show():t.$$("endByDate").hide()}},webix.DataLoader,webix.ui.form,webix.EventSystem,webix.Settings)})}();
//# sourceMappingURL=./scheduler.js.map